{"ast":null,"code":"var _jsxFileName = \"/Users/yiqianyao/workspace/something/floorcanvas/src/components/index.tsx\";\nimport React from 'react';\nimport { isOnTable } from './utils'; // import { isPointInPolygon } from './math'\n// import { rgb } from 'd3'\n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nlet floorBaseData = {\n  shape: [[100, 100], [340, 100], [340, 200], [300, 200], [300, 380], [100, 380]],\n  holes: [[[120, 120], [160, 120], [160, 180], [120, 180]], [[120, 220], [140, 220], [140, 240], [120, 240]]]\n};\nlet tableData = [{\n  user: '315103',\n  tableid: '6-6-201',\n  shape: [[170, 160], [180, 160], [180, 170], [170, 170]]\n}, {\n  user: '315104',\n  tableid: '6-6-204',\n  shape: [[190, 160], [200, 160], [200, 170], [190, 170]]\n}];\n\nclass Plane extends React.Component {\n  constructor(props) {\n    super(props);\n    this.canvas = void 0;\n    this.ctx = void 0;\n    this.width = void 0;\n    this.height = void 0;\n    this.top = void 0;\n    this.left = void 0;\n    this.isFloorSelect = false;\n    this.selectedTable = null;\n    this.width = 100;\n    this.height = 100;\n    this.top = 0;\n    this.left = 0;\n    this.handleClick = this.handleClick.bind(this);\n  }\n\n  componentDidMount() {\n    this.initProperties(); // console.log(rgb('rgb(1, 2, 3)'))\n\n    this.draw();\n    this.canvas.addEventListener('click', this.handleClick, false);\n  }\n\n  componentWillUnmount() {\n    this.canvas.removeEventListener('click', this.handleClick);\n  }\n\n  initProperties() {\n    let {\n      width,\n      height\n    } = this.props;\n    this.width = width;\n    this.height = height;\n    this.ctx = this.setCanvas(width, height);\n    let {\n      top,\n      left\n    } = this.canvas.getBoundingClientRect();\n    this.top = top;\n    this.left = left;\n  }\n\n  draw() {\n    this.drawFloorBase(this.ctx, floorBaseData, '#00f', '#0ff');\n    this.drawTables(this.ctx, tableData, '#f00', '#0f0');\n  }\n\n  handleClick(e) {\n    let {\n      clientX,\n      clientY\n    } = e;\n    let x = clientX - this.left;\n    let y = clientY - this.top; // let b = isPointInFloor([x, y], floorBaseData)\n    // console.log(b)\n\n    console.log(isOnTable([x, y], tableData));\n  }\n\n  drawTables(ctx, tableData, strokeStyle, fillStyle) {\n    ctx.strokeStyle = strokeStyle;\n    ctx.fillStyle = fillStyle;\n    tableData.map(td => {\n      let {\n        shape\n      } = td; // draw line\n\n      ctx.beginPath();\n      shape.map(s => {\n        ctx.lineTo(...s);\n      });\n      ctx.lineTo(...shape[0]);\n      ctx.closePath();\n      ctx.fill();\n      ctx.stroke();\n    });\n  } // 绘制楼层 - 不需要被选中\n\n\n  drawFloorBase(ctx, floorBaseData, strokeStyle, fillStyle) {\n    let {\n      shape,\n      holes\n    } = floorBaseData;\n    ctx.strokeStyle = strokeStyle;\n    ctx.fillStyle = fillStyle; // draw line\n\n    ctx.beginPath();\n    shape.map(s => {\n      ctx.lineTo(...s);\n    });\n    ctx.lineTo(...shape[0]);\n    ctx.closePath();\n    ctx.fill();\n    ctx.stroke(); // draw holes\n\n    holes.map(hole => {\n      ctx.beginPath();\n      ctx.save();\n      hole.map(h => {\n        ctx.lineTo(...h);\n      });\n      ctx.lineTo(...hole[0]);\n      ctx.clip();\n      ctx.clearRect(0, 0, this.width, this.height);\n      ctx.closePath();\n      ctx.restore();\n      ctx.stroke();\n    });\n  }\n\n  drawBalcany() {}\n\n  setCanvas(width, height) {\n    this.canvas.style.width = width + 'px';\n    this.canvas.style.height = height + 'px';\n    this.canvas.width = width;\n    this.canvas.height = height;\n    return this.canvas.getContext('2d');\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"canvas\", {\n      ref: el => this.canvas = el\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 16\n    }, this);\n  }\n\n}\n\nexport default Plane;","map":{"version":3,"sources":["/Users/yiqianyao/workspace/something/floorcanvas/src/components/index.tsx"],"names":["React","isOnTable","floorBaseData","shape","holes","tableData","user","tableid","Plane","Component","constructor","props","canvas","ctx","width","height","top","left","isFloorSelect","selectedTable","handleClick","bind","componentDidMount","initProperties","draw","addEventListener","componentWillUnmount","removeEventListener","setCanvas","getBoundingClientRect","drawFloorBase","drawTables","e","clientX","clientY","x","y","console","log","strokeStyle","fillStyle","map","td","beginPath","s","lineTo","closePath","fill","stroke","hole","save","h","clip","clearRect","restore","drawBalcany","style","getContext","render","el"],"mappings":"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","sourcesContent":["import React from 'react'\nimport {\n    IPlaneProps,\n    IFloorBaseData,\n    Point,\n    ITableData\n} from './IInterface'\nimport { isPointInFloor, isOnTable } from './utils'\n// import { isPointInPolygon } from './math'\n// import { rgb } from 'd3'\n\nlet floorBaseData: IFloorBaseData = {\n    shape: [\n        [100, 100], \n        [340, 100],\n        [340, 200],\n        [300, 200],\n        [300, 380],\n        [100, 380],\n    ],\n    holes: [\n        [\n            [120, 120],\n            [160, 120],\n            [160, 180],\n            [120, 180]\n        ],\n        [\n            [120, 220],\n            [140, 220],\n            [140, 240],\n            [120, 240]\n        ]\n    ]\n}\n\nlet tableData: ITableData[] = [\n    {\n        user: '315103',\n        tableid: '6-6-201',\n        shape: [\n            [170, 160],\n            [180, 160],\n            [180, 170],\n            [170, 170]\n        ]\n    },\n    {\n        user: '315104',\n        tableid: '6-6-204',\n        shape: [\n            [190, 160],\n            [200, 160],\n            [200, 170],\n            [190, 170]\n        ]\n    }\n]\n\nclass Plane extends React.Component<IPlaneProps> {\n    private canvas!: HTMLCanvasElement;\n    private ctx!: CanvasRenderingContext2D;\n    private width: number;\n    private height: number;\n    private top: number;\n    private left: number;\n    private isFloorSelect: boolean = false;\n    private selectedTable: string|null = null;\n\n    constructor(props: IPlaneProps) {\n        super(props)\n        this.width = 100;\n        this.height = 100;\n        this.top = 0;\n        this.left = 0;\n        this.handleClick = this.handleClick.bind(this)\n    }\n\n    componentDidMount() {\n        this.initProperties()\n        \n        // console.log(rgb('rgb(1, 2, 3)'))\n        this.draw()\n        \n\n        this.canvas.addEventListener('click', this.handleClick, false)\n     \n    }\n\n    componentWillUnmount() {\n        this.canvas.removeEventListener('click', this.handleClick)\n    }\n\n    initProperties() {\n        let { width, height } = this.props\n        this.width = width \n        this.height = height\n        this.ctx = this.setCanvas(width, height)\n        let { top, left } = this.canvas.getBoundingClientRect()\n        this.top = top\n        this.left = left\n    }\n\n    draw() {\n        this.drawFloorBase(this.ctx, floorBaseData, '#00f', '#0ff')\n        this.drawTables(this.ctx, tableData, '#f00', '#0f0')\n    }\n\n    handleClick(e: MouseEvent) {\n        let {clientX, clientY} = e\n        let x = clientX - this.left\n        let y = clientY - this.top\n\n\n        // let b = isPointInFloor([x, y], floorBaseData)\n        // console.log(b)\n\n        console.log(isOnTable([x, y], tableData))\n    }\n\n    drawTables(ctx: CanvasRenderingContext2D, tableData: ITableData[], strokeStyle: string, fillStyle: string) {\n        ctx.strokeStyle = strokeStyle\n        ctx.fillStyle = fillStyle\n\n        tableData.map((td: ITableData) => {\n            let { shape } = td\n            // draw line\n            ctx.beginPath()\n            shape.map((s: Point): void => {\n                ctx.lineTo(...s)\n            })\n            ctx.lineTo(...shape[0])\n            ctx.closePath()\n            ctx.fill()\n            ctx.stroke()\n        })\n    }\n\n    // 绘制楼层 - 不需要被选中\n    drawFloorBase(ctx: CanvasRenderingContext2D, floorBaseData: IFloorBaseData, strokeStyle: string, fillStyle: string) {\n        let { shape, holes } = floorBaseData\n\n        ctx.strokeStyle = strokeStyle\n        ctx.fillStyle = fillStyle\n\n        // draw line\n        ctx.beginPath()\n        shape.map((s: Point): void => {\n            ctx.lineTo(...s)\n        })\n        ctx.lineTo(...shape[0])\n        ctx.closePath()\n        ctx.fill()\n        ctx.stroke()\n\n        // draw holes\n        holes.map(hole => {\n            ctx.beginPath()\n            ctx.save()\n\n            hole.map((h: Point) => {\n                ctx.lineTo(...h)\n            })\n            ctx.lineTo(...hole[0])\n\n            ctx.clip()\n            ctx.clearRect(0, 0, this.width, this.height)\n            \n            ctx.closePath()\n            ctx.restore()\n            ctx.stroke()\n        })\n    }\n\n    drawBalcany() {\n        \n    }\n\n    setCanvas(width: number, height: number): CanvasRenderingContext2D {\n        this.canvas.style.width = width + 'px'\n        this.canvas.style.height = height + 'px'\n        this.canvas.width = width\n        this.canvas.height = height\n        return this.canvas.getContext('2d') as CanvasRenderingContext2D\n    }\n\n    render() {\n        return <canvas ref={el=>this.canvas = el as HTMLCanvasElement}></canvas>\n    }\n}\n\nexport default Plane"]},"metadata":{},"sourceType":"module"}